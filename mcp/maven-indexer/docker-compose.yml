# Maven Indexer MCP Server
#
# Indexes ~/.gradle and ~/.m2 caches for class search and CFR decompilation.
# Claude Code connects via STDIO through `docker exec -i`.
#
# Usage:
#   docker compose up -d
#   docker compose logs -f maven-indexer   # watch initial indexing

services:

    maven-indexer:
        image: node:22-slim
        container_name: mcp-maven-indexer
        restart: unless-stopped
        stdin_open: true
        working_dir: /app
        entrypoint: ["npx", "-y", "maven-indexer-mcp@latest"]
        environment:
            # Filter to specific packages if needed (default: index everything)
            - INCLUDED_PACKAGES=*
            # How to pick the "best" version when multiple exist
            # Options: semver | latest-published | latest-used
            - VERSION_RESOLUTION_STRATEGY=semver
            # Make SDKMAN-managed Java available for CFR decompilation
            - PATH=/opt/java/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
            - JAVA_HOME=/opt/java
        volumes:
            # Mount local caches read-only
            - ${GRADLE_CACHE:-${HOME}/.gradle/caches/modules-2/files-2.1}:/root/.gradle/caches/modules-2/files-2.1:ro
            - ${MAVEN_REPO:-${HOME}/.m2/repository}:/root/.m2/repository:ro
            # Mount SDKMAN Java (follows host's current version)
            - ${SDKMAN_DIR:-${HOME}/.sdkman}/candidates/java/current:/opt/java:ro
            # Persist the SQLite index between restarts
            - maven-indexer-data:/root/.maven-indexer-mcp

volumes:
    maven-indexer-data:
